#include "shell.h"

/**
 * _getline - custom getline
 * @line: buffer where line is stored
 * @size: buffer where line size is stored
 * @stream: file pointer to stdin
 * Return: number of characters read | -1 on failure or EOF
 **/
ssize_t _getline(char **line, size_t *size, FILE *stream)
{
	int line_length, rewind_length, bytes_read, fd = fileno(stream);
	char *line_end = NULL;
	ssize_t count;

	if (!line || !(*line))
	{
		*line = malloc(MEM_CHUNK);
		if (!(*line))
			return (-1);
		*size = MEM_CHUNK;
	}

	bytes_read = 0;
	while (!line_end)
	{
		count = read(fd, *line + bytes_read, *size);
		if (count <= 0)
			return (-1);

		if ((size_t)count == *size)
		{
			*line = realloc(*line, *size + MEM_CHUNK);
			if (!(*line))
				return (-1);
			*size += MEM_CHUNK;
		}

		line_end = _strchr(*line + bytes_read, '\n');
		bytes_read += count;
	}

	line_length = (int)(line_end - *line);
	rewind_length = -1 * (count - line_length - 1);
	lseek(fd, rewind_length, SEEK_CUR);
	*(line_end + 1) = '\0';
	return (bytes_read);
}

/**
 * _strchr - finds first instance of a specific char in a string
 * @str: string
 * @chr: character to find
 * Return: pointer to first instance of chr
 **/
char *_strchr(char *str, int chr)
{
	if (str == NULL)
		return (NULL);

	for (; *str; str++)
		if (*str == chr)
			return (str);

	return (NULL);
}
